<h2 mat-dialog-title>{{ 'SALES.IMPORT.TITLE' | translate }}</h2>
<mat-dialog-content>
  <mat-stepper #stepper [linear]="true">
    <mat-step [label]="'SALES.IMPORT.STEP_CONFIGURE' | translate">
      <div class="step-content">
        <form [formGroup]="configForm">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ 'SALES.IMPORT.BRANCH_LABEL' | translate }} *</mat-label>
            <mat-select formControlName="branchId">
              <mat-option *ngFor="let b of data.branches" [value]="b.id">{{ b.branchName }}</mat-option>
            </mat-select>
            <mat-error>{{ 'SALES.IMPORT.BRANCH_REQUIRED' | translate }}</mat-error>
          </mat-form-field>
        </form>

        <div class="upload-zone" (click)="fileInput.click()" [class.has-file]="selectedFile">
          <input #fileInput type="file" accept=".xlsx,.xls,.csv" (change)="onFileSelected($event)" style="display:none">
          <mat-icon>{{ selectedFile ? 'check_circle' : 'upload_file' }}</mat-icon>
          <p *ngIf="!selectedFile">{{ 'SALES.IMPORT.DROP_ZONE' | translate }}</p>
          <p *ngIf="selectedFile" class="filename">{{ selectedFile.name }}</p>
          <small *ngIf="!selectedFile">{{ 'SALES.IMPORT.SUPPORTED' | translate }}</small>
        </div>

        <div class="template-hint">
          <mat-icon>info</mat-icon>
          <span>{{ 'SALES.IMPORT.TEMPLATE_HINT' | translate }} <code>productId</code>, <code>quantity</code>, <code>unitPrice</code>, <code>lineTotal</code></span>
          <button mat-button color="primary" type="button" (click)="downloadTemplate()">{{ 'SALES.IMPORT.DOWNLOAD_TEMPLATE' | translate }}</button>
        </div>

        <div class="step-actions">
          <button mat-flat-button color="primary" [disabled]="!selectedFile || configForm.invalid" (click)="parseFile(stepper)">
            {{ 'SALES.IMPORT.NEXT_PREVIEW' | translate }}
          </button>
        </div>
      </div>
    </mat-step>

    <mat-step [label]="'SALES.IMPORT.STEP_PREVIEW' | translate">
      <div class="step-content">
        <div *ngIf="parsing" class="spinner-center">
          <mat-spinner diameter="32"></mat-spinner>
          <p>{{ 'SALES.IMPORT.PARSING' | translate }}</p>
        </div>
        <div *ngIf="!parsing && previewRows.length > 0">
          <p class="preview-info">{{ previewRows.length }} {{ 'SALES.IMPORT.PREVIEW_INFO' | translate }}</p>
          <div class="preview-table-wrap">
            <table mat-table [dataSource]="previewRows.slice(0, 10)" class="preview-table">
              <ng-container *ngFor="let col of previewColumns" [matColumnDef]="col">
                <th mat-header-cell *matHeaderCellDef>{{ col }}</th>
                <td mat-cell *matCellDef="let row">{{ row[col] }}</td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="previewColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: previewColumns;"></tr>
            </table>
          </div>
          <p class="preview-note" *ngIf="previewRows.length > 10">{{ 'SALES.IMPORT.FIRST_10' | translate }} {{ previewRows.length }}</p>
        </div>
        <div *ngIf="!parsing && previewRows.length === 0" class="empty-msg">
          <mat-icon>warning</mat-icon><p>{{ 'SALES.IMPORT.NO_DATA' | translate }}</p>
        </div>
        <div class="step-actions">
          <button mat-stroked-button matStepperPrevious>{{ 'SALES.IMPORT.BACK' | translate }}</button>
          <button mat-flat-button color="primary" [disabled]="previewRows.length === 0 || importing" (click)="importFile()">
            <mat-spinner *ngIf="importing" diameter="18" style="display:inline-block;margin-inline-end:6px"></mat-spinner>
            {{ 'SALES.IMPORT.IMPORT_BTN' | translate }} {{ previewRows.length }} {{ 'SALES.IMPORT.RECORDS' | translate }}
          </button>
        </div>
      </div>
    </mat-step>
  </mat-stepper>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button mat-stroked-button [mat-dialog-close]="false">{{ 'SALES.IMPORT.CLOSE' | translate }}</button>
</mat-dialog-actions>
